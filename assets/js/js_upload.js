$(document).ready(function(){function r(e){var t=new Firebase("https://flickering-fire-8139.firebaseio.com");var n=Math.floor(Math.random()*1e7)+1;var r="uncategorized";var s="";var o=1;var u="";t.push({ID:n,album:r,comments:s,imageSource:e,rating:o,tags:u,timeStamp:i()})}function i(){var e=new Date;var t=e.getDate();var n=e.getMonth()+1;var r=e.getFullYear();if(t<10){t="0"+t}if(n<10){n="0"+n}e=n+"/"+t+"/"+r;var i=new Date;var s=i.getHours();var o=i.getMinutes();if(o<10){o="0"+o}if(s>11){if(s != 12){s=s-12;}var u="PM"}else{var u="AM"}var a=e+" @ "+s+":"+o+" "+u;return a}function s(e){return(e/1024).toFixed(1)}function o(e,t){var n=[];if(e>t){n[0]=e-t;n[1]=0}else{n[0]=0;n[1]=t-e}return n}function u(e){var t;if(e.split(",")[0].indexOf("base64")>=0)t=atob(e.split(",")[1]);else t=unescape(e.split(",")[1]);var n=e.split(",")[0].split(":")[1].split(";")[0];var r=new ArrayBuffer(t.length);var i=new Uint8Array(r);for(var s=0;s<t.length;s++){i[s]=t.charCodeAt(s)}var o=new DataView(r);var u=new Blob([o],{type:n});return u}var e=220,t=220,n=0;dropzone=$("#droparea"),uploadBtn=$("#uploadbtn"),defaultUploadBtn=$("#upload");dropzone.on("dragover",function(){dropzone.addClass("hover");return false});dropzone.on("dragleave",function(){dropzone.removeClass("hover");return false});dropzone.on("drop",function(e){e.stopPropagation();e.preventDefault();dropzone.removeClass("hover");var t=e.originalEvent.dataTransfer.files;c(t);return false});uploadBtn.on("click",function(e){e.stopPropagation();e.preventDefault();defaultUploadBtn.click()});defaultUploadBtn.on("change",function(){var e=$(this)[0].files;c(e);return false});var a=function(n){var r=n.getImageData(0,0,e,t);var i=r.data;for(var s=0,o=i.length;s<o;s+=4){var u=i[s]*.3+i[s+1]*.59+i[s+2]*.11;i[s]=u;i[s+1]=u;i[s+2]=u}n.putImageData(r,0,0)};var f=function(n,r,i){var s,o,u,a=4;n.globalAlpha=.1;for(s=1;s<=a;s++){for(u=-a/2;u<=a/2;u++){for(o=-a/2;o<=a/2;o++){n.drawImage(r,i[0]/2,i[1]/2,r.width-i[0],r.height-i[1],o,u,e,t)}}}n.globalAlpha=1};var l=function(n){var r=[0,0,0,1,1,2,3,3,3,4,4,4,5,5,5,6,6,7,7,7,7,8,8,8,9,9,9,9,10,10,10,10,11,11,12,12,12,12,13,13,13,14,14,15,15,16,16,17,17,17,18,19,19,20,21,22,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,39,40,41,42,44,45,47,48,49,52,54,55,57,59,60,62,65,67,69,70,72,74,77,79,81,83,86,88,90,92,94,97,99,101,103,107,109,111,112,116,118,120,124,126,127,129,133,135,136,140,142,143,145,149,150,152,155,157,159,162,163,165,167,170,171,173,176,177,178,180,183,184,185,188,189,190,192,194,195,196,198,200,201,202,203,204,206,207,208,209,211,212,213,214,215,216,218,219,219,220,221,222,223,224,225,226,227,227,228,229,229,230,231,232,232,233,234,234,235,236,236,237,238,238,239,239,240,241,241,242,242,243,244,244,245,245,245,246,247,247,248,248,249,249,249,250,251,251,252,252,252,253,254,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],i=[0,0,1,2,2,3,5,5,6,7,8,8,10,11,11,12,13,15,15,16,17,18,18,19,21,22,22,23,24,26,26,27,28,29,31,31,32,33,34,35,35,37,38,39,40,41,43,44,44,45,46,47,48,50,51,52,53,54,56,57,58,59,60,61,63,64,65,66,67,68,69,71,72,73,74,75,76,77,79,80,81,83,84,85,86,88,89,90,92,93,94,95,96,97,100,101,102,103,105,106,107,108,109,111,113,114,115,117,118,119,120,122,123,124,126,127,128,129,131,132,133,135,136,137,138,140,141,142,144,145,146,148,149,150,151,153,154,155,157,158,159,160,162,163,164,166,167,168,169,171,172,173,174,175,176,177,178,179,181,182,183,184,186,186,187,188,189,190,192,193,194,195,195,196,197,199,200,201,202,202,203,204,205,206,207,208,208,209,210,211,212,213,214,214,215,216,217,218,219,219,220,221,222,223,223,224,225,226,226,227,228,228,229,230,231,232,232,232,233,234,235,235,236,236,237,238,238,239,239,240,240,241,242,242,242,243,244,245,245,246,246,247,247,248,249,249,249,250,251,251,252,252,252,253,254,255],s=[53,53,53,54,54,54,55,55,55,56,57,57,57,58,58,58,59,59,59,60,61,61,61,62,62,63,63,63,64,65,65,65,66,66,67,67,67,68,69,69,69,70,70,71,71,72,73,73,73,74,74,75,75,76,77,77,78,78,79,79,80,81,81,82,82,83,83,84,85,85,86,86,87,87,88,89,89,90,90,91,91,93,93,94,94,95,95,96,97,98,98,99,99,100,101,102,102,103,104,105,105,106,106,107,108,109,109,110,111,111,112,113,114,114,115,116,117,117,118,119,119,121,121,122,122,123,124,125,126,126,127,128,129,129,130,131,132,132,133,134,134,135,136,137,137,138,139,140,140,141,142,142,143,144,145,145,146,146,148,148,149,149,150,151,152,152,153,153,154,155,156,156,157,157,158,159,160,160,161,161,162,162,163,164,164,165,165,166,166,167,168,168,169,169,170,170,171,172,172,173,173,174,174,175,176,176,177,177,177,178,178,179,180,180,181,181,181,182,182,183,184,184,184,185,185,186,186,186,187,188,188,188,189,189,189,190,190,191,191,192,192,193,193,193,194,194,194,195,196,196,196,197,197,197,198,199];var o=20;var u=n.getImageData(0,0,e,t);var a=u.data;for(var f=0;f<a.length;f+=4){a[f]=r[a[f]];a[f+1]=i[a[f+1]];a[f+2]=s[a[f+2]];if(o>0){var o=Math.round(o-Math.random()*o);for(var l=0;l<3;l++){var c=o+a[f+l];a[f+l]=c>255?255:c}}}n.putImageData(u,0,0)};var c=function(e){if(e&&typeof FileReader!=="undefined"){for(var t=0;t<e.length;t++){h(e[t])}}else{}};var h=function(e){if(/image/i.test(e.type)){var t=new FileReader;t.onload=function(t){var n=$("<img/>").load(function(){var t=p(this);d(e,t)}).attr("src",t.target.result)};t.readAsDataURL(e);$("#err").text("")}else{$("#err").text("*Selected file format not supported!")}};var p=function(n){var r=$("input[name=effect]:checked").val();var i=$("input[name=croping]:checked").val();var s=document.createElement("canvas");s.width=e;s.height=t;var u=s.getContext("2d");var c=[0,0];if(i=="crop"){c=o(n.width,n.height)}u.drawImage(n,c[0]/2,c[1]/2,n.width-c[0],n.height-c[1],0,0,e,t);if(r=="grayscale"){a(u)}else if(r=="blurry"){f(u,n,c)}else if(r=="sepia"){l(u)}else{}return s.toDataURL("image/jpeg")};var d=function(e,t){var i={};i.filePath=t;r(t);i.fileName=e.name.substr(0,e.name.lastIndexOf("."));i.fileOriSize=s(e.size);i.fileUploadSize=s(u(t).size);var o=$("input[name=effect]:checked").val();if(o=="grayscale"){i.fileName+=" (Grayscale)"}else if(o=="blurry"){i.fileName+=" (Blurry)"}var a=0;var f=$("#imageTemplate").tmpl(i).prependTo("#result").hide().css({Transform:"scale(1) rotate("+a+"deg)",msTransform:"scale(1) rotate("+a+"deg)",MozTransform:"scale(1) rotate("+a+"deg)",webkitTransform:"scale(1) rotate("+a+"deg)",OTransform:"scale(1) rotate("+a+"deg)","z-index":n++}).show();if(isNaN(i.fileUploadSize)){$(".imageholder span").last().hide()}};var v=function(e){var t={};var r=["jpg","jpeg","gif","png"];var i=e.value;if(i){var s=i.indexOf("\\")>=0?i.lastIndexOf("\\"):i.lastIndexOf("/");var o=i.substring(s);if(o.indexOf("\\")===0||o.indexOf("/")===0){o=o.substring(1)}var u=o.substr(0,o.lastIndexOf("."));var a=o.slice(o.lastIndexOf(".")+1).toLowerCase();if($.inArray(a,r)>-1){$("#err").text("");t.filepath=i;t.filename=u;var f=Math.floor(Math.random()*31)-15;$("#imageTemplate").tmpl(t).prependTo("#result").hide().css({Transform:"scale(1) rotate("+f+"deg)",msTransform:"scale(1) rotate("+f+"deg)",MozTransform:"scale(1) rotate("+f+"deg)",webkitTransform:"scale(1) rotate("+f+"deg)",oTransform:"scale(1) rotate("+f+"deg)","z-index":n++}).show();$("#result").find("figcaption span").hide()}else{$("#err").text("*Selected file format not supported!")}}};if(typeof FileReader==="undefined"){$("#err").html("Hey! Your browser does not support <strong>HTML5 File API</strong> <br/>Try using Chrome or Firefox to have it works!")}else if(!Modernizr.draganddrop){$("#err").html("Ops! Look like your browser does not support <strong>Drag and Drop API</strong>! <br/>Still, you are able to use '<em>Select Files</em>' button to upload file =)")}else{$("#err").text("")}})